# ============================================================================
# Reusable Alexa Room Announce Script
# ============================================================================
# Called by voice-query automations (humidity, window status, etc.).
# Resolves the target speaker from the 'notify_target' custom attribute
# on the trigger entity (configured in customize.yaml).
#
# Parameters:
#   trigger_entity  - the input_boolean entity_id that was turned on
#   message         - the TTS text to announce
# ============================================================================
alexa_room_announce:
  alias: Alexa Room Announce
  description: Announces a message on the Alexa speaker that matches the triggering input_boolean
  fields:
    trigger_entity:
      description: The input_boolean entity_id that was turned on (e.g. input_boolean.humidity_request_buero)
      required: true
      selector:
        entity:
          domain: input_boolean
    message:
      description: The TTS message to announce
      required: true
      selector:
        text:
  sequence:
  - variables:
      notify_target: "{{ state_attr(trigger_entity, 'notify_target') }}"
  - service: notify.send_message
    target:
      entity_id: "{{ notify_target }}"
    data:
      message: "{{ message }}"
  - service: input_boolean.turn_off
    target:
      entity_id: "{{ trigger_entity }}"
  mode: parallel
  max: 4
